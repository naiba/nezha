{{define "theme-server-status/home"}}
{{template "theme-server-status/header" .}}
<div id="app">
    {{template "theme-server-status/content-nav" .}}   
    <!--  showGroup true -->
    <template v-if="showGroup">
        <section class="container table-responsive content" style="max-width: 95vw" v-for="group in nodesTag">
            {{template "theme-server-status/home-group-true" .}} 
        </section>
    </template>
    <!--  showGroup false -->
    <template v-else>
        <section class="container table-responsive content" style="max-width: 95vw">
            {{template "theme-server-status/home-group-false" .}}
        </section>
    </template>
    <div class="modal fade" id="mapChartBox" tabindex="-1" role="dialog" aria-labelledby="mapChartTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="mapChartTitle">{{tr "ServersOnWorldMap"}}</h4>
                    <i class="bi bi-x" data-dismiss="modal" aria-label="Close"></i>
                </div>
                <div class="modal-body">
                    <div id="mapChart" style="width:100%;height:auto;"></div>
                </div>
            </div>
        </div>
    </div>
    {{template "theme-server-status/content-footer" .}}
</div>
<script>
    new Vue({
        el: '#app',
        delimiters: ['@#', '#@'],
        data: {
            page: 'index',
            defaultTemplate: {{.Conf.Site.Theme}},
            templates: {{.Themes}},
            cache: [],
            servers: [],
            nodesTag: [],
            nodesNoTag: [],
            chartDataList: [],
            ws: null,
            language: {{.Conf.Language}},
            countryMap: {"ad":{"flag":"ðŸ‡¦ðŸ‡©","en":"Andorra","zh":"å®‰é“å°”"},"ae":{"flag":"ðŸ‡¦ðŸ‡ª","en":"United Arab Emirates","zh":"é˜¿è”é…‹"},"af":{"flag":"ðŸ‡¦ðŸ‡«","en":"Afghanistan","zh":"é˜¿å¯Œæ±—"},"ag":{"flag":"ðŸ‡¦ðŸ‡¬","en":"Antigua and Barb.","zh":"å®‰æç“œå’Œå·´å¸ƒè¾¾"},"ai":{"flag":"ðŸ‡¦ðŸ‡®","en":"Anguilla","zh":"å®‰åœ­æ‹‰"},"al":{"flag":"ðŸ‡¦ðŸ‡±","en":"Albania","zh":"é˜¿å°”å·´å°¼äºš"},"am":{"flag":"ðŸ‡¦ðŸ‡²","en":"Armenia","zh":"äºšç¾Žå°¼äºš"},"ao":{"flag":"ðŸ‡¦ðŸ‡´","en":"Angola","zh":"å®‰å“¥æ‹‰"},"aq":{"flag":"ðŸ‡¦ðŸ‡¶","en":"Antarctica","zh":"å—æžæ´²"},"ar":{"flag":"ðŸ‡¦ðŸ‡·","en":"Argentina","zh":"é˜¿æ ¹å»·"},"as":{"flag":"ðŸ‡¦ðŸ‡¸","en":"American Samoa","zh":"ç¾Žå±žè¨æ‘©äºš"},"Ashmore and Cartier Is.":{"flag":"","en":"Ashmore and Cartier Is.","zh":"é˜¿ä»€èŽ«å°”å’Œå¡æ·ç¾¤å²›"},"at":{"flag":"ðŸ‡¦ðŸ‡¹","en":"Austria","zh":"å¥¥åœ°åˆ©"},"au":{"flag":"ðŸ‡¦ðŸ‡º","en":"Australia","zh":"æ¾³å¤§åˆ©äºš"},"aw":{"flag":"ðŸ‡¦ðŸ‡¼","en":"Aruba","zh":"é˜¿é²å·´"},"ax":{"flag":"ðŸ‡¦ðŸ‡½","en":"Ã…land","zh":"å¥¥å…°"},"az":{"flag":"ðŸ‡¦ðŸ‡¿","en":"Azerbaijan","zh":"é˜¿å¡žæ‹œç–†"},"ba":{"flag":"ðŸ‡§ðŸ‡¦","en":"Bosnia and Herz.","zh":"æ³¢é»‘"},"bb":{"flag":"ðŸ‡§ðŸ‡§","en":"Barbados","zh":"å·´å·´å¤šæ–¯"},"bd":{"flag":"ðŸ‡§ðŸ‡©","en":"Bangladesh","zh":"å­ŸåŠ æ‹‰å›½"},"be":{"flag":"ðŸ‡§ðŸ‡ª","en":"Belgium","zh":"æ¯”åˆ©æ—¶"},"bf":{"flag":"ðŸ‡§ðŸ‡«","en":"Burkina Faso","zh":"å¸ƒåŸºçº³æ³•ç´¢"},"bg":{"flag":"ðŸ‡§ðŸ‡¬","en":"Bulgaria","zh":"ä¿åŠ åˆ©äºš"},"bh":{"flag":"ðŸ‡§ðŸ‡­","en":"Bahrain","zh":"å·´æž—"},"bi":{"flag":"ðŸ‡§ðŸ‡®","en":"Burundi","zh":"å¸ƒéš†è¿ª"},"bj":{"flag":"ðŸ‡§ðŸ‡¯","en":"Benin","zh":"è´å®"},"bl":{"flag":"ðŸ‡§ðŸ‡±","en":"St-BarthÃ©lemy","zh":"åœ£å·´æ³°å‹’ç±³"},"bm":{"flag":"ðŸ‡§ðŸ‡²","en":"Bermuda","zh":"ç™¾æ…•å¤§"},"bn":{"flag":"ðŸ‡§ðŸ‡³","en":"Brunei","zh":"æ–‡èŽ±"},"bo":{"flag":"ðŸ‡§ðŸ‡´","en":"Bolivia","zh":"çŽ»åˆ©ç»´äºš"},"bq":{"flag":"ðŸ‡§ðŸ‡¶","en":"Bonaire, Sint Eustatius and Saba","zh":"è·å…°åŠ å‹’æ¯”åŒº"},"br":{"flag":"ðŸ‡§ðŸ‡·","en":"Brazil","zh":"å·´è¥¿"},"bs":{"flag":"ðŸ‡§ðŸ‡¸","en":"Bahamas","zh":"å·´å“ˆé©¬"},"bt":{"flag":"ðŸ‡§ðŸ‡¹","en":"Bhutan","zh":"ä¸ä¸¹"},"bv":{"flag":"ðŸ‡§ðŸ‡»","en":"Bouvet Island","zh":"å¸ƒéŸ¦å²›"},"bw":{"flag":"ðŸ‡§ðŸ‡¼","en":"Botswana","zh":"åšèŒ¨ç“¦çº³"},"by":{"flag":"ðŸ‡§ðŸ‡¾","en":"Belarus","zh":"ç™½ä¿„ç½—æ–¯"},"bz":{"flag":"ðŸ‡§ðŸ‡¿","en":"Belize","zh":"ä¼¯åˆ©å…¹"},"ca":{"flag":"ðŸ‡¨ðŸ‡¦","en":"Canada","zh":"åŠ æ‹¿å¤§"},"cc":{"flag":"ðŸ‡¨ðŸ‡¨","en":"Cocos (Keeling) Islands","zh":"ç§‘ç§‘æ–¯ï¼ˆåŸºæž—ï¼‰ç¾¤å²›"},"cd":{"flag":"ðŸ‡¨ðŸ‡©","en":"Dem. Rep. Congo","zh":"åˆšæžœæ°‘ä¸»å…±å’Œå›½"},"cf":{"flag":"ðŸ‡¨ðŸ‡«","en":"Central African Rep.","zh":"ä¸­éž"},"cg":{"flag":"ðŸ‡¨ðŸ‡¬","en":"Congo","zh":"åˆšæžœå…±å’Œå›½"},"ch":{"flag":"ðŸ‡¨ðŸ‡­","en":"Switzerland","zh":"ç‘žå£«"},"ci":{"flag":"ðŸ‡¨ðŸ‡®","en":"CÃ´te d'Ivoire","zh":"ç§‘ç‰¹è¿ªç“¦"},"ck":{"flag":"ðŸ‡¨ðŸ‡°","en":"Cook Is.","zh":"åº“å…‹ç¾¤å²›"},"cl":{"flag":"ðŸ‡¨ðŸ‡±","en":"Chile","zh":"æ™ºåˆ©"},"cm":{"flag":"ðŸ‡¨ðŸ‡²","en":"Cameroon","zh":"å–€éº¦éš†"},"cn":{"flag":"ðŸ‡¨ðŸ‡³","en":"China","zh":"ä¸­å›½"},"co":{"flag":"ðŸ‡¨ðŸ‡´","en":"Colombia","zh":"å“¥ä¼¦æ¯”äºš"},"cr":{"flag":"ðŸ‡¨ðŸ‡·","en":"Costa Rica","zh":"å“¥æ–¯è¾¾é»ŽåŠ "},"cu":{"flag":"ðŸ‡¨ðŸ‡º","en":"Cuba","zh":"å¤å·´"},"cv":{"flag":"ðŸ‡¨ðŸ‡»","en":"Cabo Verde","zh":"ä½›å¾—è§’"},"cw":{"flag":"ðŸ‡¨ðŸ‡¼","en":"CuraÃ§ao","zh":"åº“æ‹‰ç´¢"},"cx":{"flag":"ðŸ‡¨ðŸ‡½","en":"Christmas Island","zh":"åœ£è¯žå²›"},"cy":{"flag":"ðŸ‡¨ðŸ‡¾","en":"Cyprus","zh":"å¡žæµ¦è·¯æ–¯"},"cz":{"flag":"ðŸ‡¨ðŸ‡¿","en":"Czech Rep.","zh":"æ·å…‹"},"de":{"flag":"ðŸ‡©ðŸ‡ª","en":"Germany","zh":"å¾·å›½"},"dj":{"flag":"ðŸ‡©ðŸ‡¯","en":"Djibouti","zh":"å‰å¸ƒæ"},"dk":{"flag":"ðŸ‡©ðŸ‡°","en":"Denmark","zh":"ä¸¹éº¦"},"dm":{"flag":"ðŸ‡©ðŸ‡²","en":"Dominica","zh":"å¤šç±³å°¼å…‹"},"do":{"flag":"ðŸ‡©ðŸ‡´","en":"Dominican Rep.","zh":"å¤šç±³å°¼åŠ "},"dz":{"flag":"ðŸ‡©ðŸ‡¿","en":"Algeria","zh":"é˜¿å°”åŠåˆ©äºš"},"ec":{"flag":"ðŸ‡ªðŸ‡¨","en":"Ecuador","zh":"åŽ„ç“œå¤šå°”"},"ee":{"flag":"ðŸ‡ªðŸ‡ª","en":"Estonia","zh":"çˆ±æ²™å°¼äºš"},"eg":{"flag":"ðŸ‡ªðŸ‡¬","en":"Egypt","zh":"åŸƒåŠ"},"eh":{"flag":"ðŸ‡ªðŸ‡­","en":"W. Sahara","zh":"è¥¿æ’’å“ˆæ‹‰"},"er":{"flag":"ðŸ‡ªðŸ‡·","en":"Eritrea","zh":"åŽ„ç«‹ç‰¹é‡Œäºš"},"es":{"flag":"ðŸ‡ªðŸ‡¸","en":"Spain","zh":"è¥¿ç­ç‰™"},"et":{"flag":"ðŸ‡ªðŸ‡¹","en":"Ethiopia","zh":"åŸƒå¡žä¿„æ¯”äºš"},"fi":{"flag":"ðŸ‡«ðŸ‡®","en":"Finland","zh":"èŠ¬å…°"},"fj":{"flag":"ðŸ‡«ðŸ‡¯","en":"Fiji","zh":"æ–æµŽ"},"fk":{"flag":"ðŸ‡«ðŸ‡°","en":"Falkland Is.","zh":"ç¦å…‹å…°ç¾¤å²›"},"fm":{"flag":"ðŸ‡«ðŸ‡²","en":"Micronesia","zh":"å¯†å…‹ç½—å°¼è¥¿äºšè”é‚¦"},"fo":{"flag":"ðŸ‡«ðŸ‡´","en":"Faeroe Is.","zh":"æ³•ç½—ç¾¤å²›"},"fr":{"flag":"ðŸ‡«ðŸ‡·","en":"France","zh":"æ³•å›½"},"ga":{"flag":"ðŸ‡¬ðŸ‡¦","en":"Gabon","zh":"åŠ è“¬"},"gb":{"flag":"ðŸ‡¬ðŸ‡§","en":"United Kingdom","zh":"è‹±å›½"},"gd":{"flag":"ðŸ‡¬ðŸ‡©","en":"Grenada","zh":"æ ¼æž—çº³è¾¾"},"ge":{"flag":"ðŸ‡¬ðŸ‡ª","en":"Georgia","zh":"æ ¼é²å‰äºš"},"gf":{"flag":"ðŸ‡¬ðŸ‡«","en":"French Guiana","zh":"æ³•å±žåœ­äºšé‚£"},"gg":{"flag":"ðŸ‡¬ðŸ‡¬","en":"Guernsey","zh":"æ ¹è¥¿"},"gh":{"flag":"ðŸ‡¬ðŸ‡­","en":"Ghana","zh":"åŠ çº³"},"gi":{"flag":"ðŸ‡¬ðŸ‡®","en":"Gibraltar","zh":"ç›´å¸ƒç½—é™€"},"gl":{"flag":"ðŸ‡¬ðŸ‡±","en":"Greenland","zh":"æ ¼é™µå…°"},"gm":{"flag":"ðŸ‡¬ðŸ‡²","en":"Gambia","zh":"å†ˆæ¯”äºš"},"gn":{"flag":"ðŸ‡¬ðŸ‡³","en":"Guinea","zh":"å‡ å†…äºš"},"gp":{"flag":"ðŸ‡¬ðŸ‡µ","en":"Guadeloupe","zh":"ç“œå¾·ç½—æ™®"},"gq":{"flag":"ðŸ‡¬ðŸ‡¶","en":"Eq. Guinea","zh":"èµ¤é“å‡ å†…äºš"},"gr":{"flag":"ðŸ‡¬ðŸ‡·","en":"Greece","zh":"å¸Œè…Š"},"gs":{"flag":"ðŸ‡¬ðŸ‡¸","en":"S. Geo. and the Is.","zh":"å—ä¹”æ²»äºšå’Œå—æ¡‘å¨å¥‡ç¾¤å²›"},"gt":{"flag":"ðŸ‡¬ðŸ‡¹","en":"Guatemala","zh":"å±åœ°é©¬æ‹‰"},"gu":{"flag":"ðŸ‡¬ðŸ‡º","en":"Guam","zh":"å…³å²›"},"gw":{"flag":"ðŸ‡¬ðŸ‡¼","en":"Guinea-Bissau","zh":"å‡ å†…äºšæ¯”ç»"},"gy":{"flag":"ðŸ‡¬ðŸ‡¾","en":"Guyana","zh":"åœ­äºšé‚£"},"hk":{"flag":"ðŸ‡­ðŸ‡°","en":"Hong Kong","zh":"é¦™æ¸¯"},"hm":{"flag":"ðŸ‡­ðŸ‡²","en":"Heard I. and McDonald Is.","zh":"èµ«å¾·å²›å’Œéº¦å…‹å”çº³ç¾¤å²›"},"hn":{"flag":"ðŸ‡­ðŸ‡³","en":"Honduras","zh":"æ´ªéƒ½æ‹‰æ–¯"},"hr":{"flag":"ðŸ‡­ðŸ‡·","en":"Croatia","zh":"å…‹ç½—åœ°äºš"},"ht":{"flag":"ðŸ‡­ðŸ‡¹","en":"Haiti","zh":"æµ·åœ°"},"hu":{"flag":"ðŸ‡­ðŸ‡º","en":"Hungary","zh":"åŒˆç‰™åˆ©"},"id":{"flag":"ðŸ‡®ðŸ‡©","en":"Indonesia","zh":"å°åº¦å°¼è¥¿äºš"},"ie":{"flag":"ðŸ‡®ðŸ‡ª","en":"Ireland","zh":"çˆ±å°”å…°"},"il":{"flag":"ðŸ‡®ðŸ‡±","en":"Israel","zh":"ä»¥è‰²åˆ—"},"im":{"flag":"ðŸ‡®ðŸ‡²","en":"Isle of Man","zh":"é©¬æ©å²›"},"in":{"flag":"ðŸ‡®ðŸ‡³","en":"India","zh":"å°åº¦"},"Indian Ocean Ter.":{"flag":"ðŸ‡¨ðŸ‡½ðŸ‡¨ðŸ‡¨","en":"Indian Ocean Ter.","zh":"æ¾³å±žå°åº¦æ´‹é¢†åœ°"},"io":{"flag":"ðŸ‡®ðŸ‡´","en":"Br. Indian Ocean Ter.","zh":"è‹±å±žå°åº¦æ´‹é¢†åœ°"},"iq":{"flag":"ðŸ‡®ðŸ‡¶","en":"Iraq","zh":"ä¼Šæ‹‰å…‹"},"ir":{"flag":"ðŸ‡®ðŸ‡·","en":"Iran","zh":"ä¼Šæœ—"},"is":{"flag":"ðŸ‡®ðŸ‡¸","en":"Iceland","zh":"å†°å²›"},"it":{"flag":"ðŸ‡®ðŸ‡¹","en":"Italy","zh":"æ„å¤§åˆ©"},"je":{"flag":"ðŸ‡¯ðŸ‡ª","en":"Jersey","zh":"æ³½è¥¿"},"jm":{"flag":"ðŸ‡¯ðŸ‡²","en":"Jamaica","zh":"ç‰™ä¹°åŠ "},"jo":{"flag":"ðŸ‡¯ðŸ‡´","en":"Jordan","zh":"çº¦æ—¦"},"jp":{"flag":"ðŸ‡¯ðŸ‡µ","en":"Japan","zh":"æ—¥æœ¬"},"ke":{"flag":"ðŸ‡°ðŸ‡ª","en":"Kenya","zh":"è‚¯å°¼äºš"},"kg":{"flag":"ðŸ‡°ðŸ‡¬","en":"Kyrgyzstan","zh":"å‰å°”å‰æ–¯æ–¯å¦"},"kh":{"flag":"ðŸ‡°ðŸ‡­","en":"Cambodia","zh":"æŸ¬åŸ”å¯¨"},"ki":{"flag":"ðŸ‡°ðŸ‡®","en":"Kiribati","zh":"åŸºé‡Œå·´æ–¯"},"km":{"flag":"ðŸ‡°ðŸ‡²","en":"Comoros","zh":"ç§‘æ‘©ç½—"},"kn":{"flag":"ðŸ‡°ðŸ‡³","en":"St. Kitts and Nevis","zh":"åœ£åŸºèŒ¨å’Œå°¼ç»´æ–¯"},"Kosovo":{"flag":"ðŸ‡½ðŸ‡°","en":"Kosovo","zh":"ç§‘ç´¢æ²ƒ"},"kp":{"flag":"ðŸ‡°ðŸ‡µ","en":"Dem. Rep. Korea","zh":"æœé²œ"},"kr":{"flag":"ðŸ‡°ðŸ‡·","en":"Korea","zh":"éŸ©å›½"},"kw":{"flag":"ðŸ‡°ðŸ‡¼","en":"Kuwait","zh":"ç§‘å¨ç‰¹"},"ky":{"flag":"ðŸ‡°ðŸ‡¾","en":"Cayman Is.","zh":"å¼€æ›¼ç¾¤å²›"},"kz":{"flag":"ðŸ‡°ðŸ‡¿","en":"Kazakhstan","zh":"å“ˆè¨å…‹æ–¯å¦"},"la":{"flag":"ðŸ‡±ðŸ‡¦","en":"Lao PDR","zh":"è€æŒ"},"lb":{"flag":"ðŸ‡±ðŸ‡§","en":"Lebanon","zh":"é»Žå·´å«©"},"lc":{"flag":"ðŸ‡±ðŸ‡¨","en":"Saint Lucia","zh":"åœ£å¢è¥¿äºš"},"li":{"flag":"ðŸ‡±ðŸ‡®","en":"Liechtenstein","zh":"åˆ—æ”¯æ•¦å£«ç™»"},"lk":{"flag":"ðŸ‡±ðŸ‡°","en":"Sri Lanka","zh":"æ–¯é‡Œå…°å¡"},"lr":{"flag":"ðŸ‡±ðŸ‡·","en":"Liberia","zh":"åˆ©æ¯”é‡Œäºš"},"ls":{"flag":"ðŸ‡±ðŸ‡¸","en":"Lesotho","zh":"èŽ±ç´¢æ‰˜"},"lt":{"flag":"ðŸ‡±ðŸ‡¹","en":"Lithuania","zh":"ç«‹é™¶å®›"},"lu":{"flag":"ðŸ‡±ðŸ‡º","en":"Luxembourg","zh":"å¢æ£®å ¡"},"lv":{"flag":"ðŸ‡±ðŸ‡»","en":"Latvia","zh":"æ‹‰è„±ç»´äºš"},"ly":{"flag":"ðŸ‡±ðŸ‡¾","en":"Libya","zh":"åˆ©æ¯”äºš"},"ma":{"flag":"ðŸ‡²ðŸ‡¦","en":"Morocco","zh":"æ‘©æ´›å“¥"},"mc":{"flag":"ðŸ‡²ðŸ‡¨","en":"Monaco","zh":"æ‘©çº³å“¥"},"md":{"flag":"ðŸ‡²ðŸ‡©","en":"Moldova","zh":"æ‘©å°”å¤šç“¦"},"me":{"flag":"ðŸ‡²ðŸ‡ª","en":"Montenegro","zh":"é»‘å±±"},"mf":{"flag":"ðŸ‡²ðŸ‡«","en":"St-Martin","zh":"æ³•å±žåœ£é©¬ä¸"},"mg":{"flag":"ðŸ‡²ðŸ‡¬","en":"Madagascar","zh":"é©¬è¾¾åŠ æ–¯åŠ "},"mh":{"flag":"ðŸ‡²ðŸ‡­","en":"Marshall Is.","zh":"é©¬ç»å°”ç¾¤å²›"},"mk":{"flag":"ðŸ‡²ðŸ‡°","en":"Macedonia","zh":"åŒ—é©¬å…¶é¡¿"},"ml":{"flag":"ðŸ‡²ðŸ‡±","en":"Mali","zh":"é©¬é‡Œ"},"mm":{"flag":"ðŸ‡²ðŸ‡²","en":"Myanmar","zh":"ç¼…ç”¸"},"mn":{"flag":"ðŸ‡²ðŸ‡³","en":"Mongolia","zh":"è’™å¤"},"mo":{"flag":"ðŸ‡²ðŸ‡´","en":"Macao","zh":"æ¾³é—¨"},"mp":{"flag":"ðŸ‡²ðŸ‡µ","en":"N. Mariana Is.","zh":"åŒ—é©¬é‡Œäºšçº³ç¾¤å²›"},"mq":{"flag":"ðŸ‡²ðŸ‡¶","en":"Martinique","zh":"é©¬æå°¼å…‹"},"mr":{"flag":"ðŸ‡²ðŸ‡·","en":"Mauritania","zh":"æ¯›é‡Œå¡”å°¼äºš"},"ms":{"flag":"ðŸ‡²ðŸ‡¸","en":"Montserrat","zh":"è’™ç‰¹å¡žæ‹‰ç‰¹"},"mt":{"flag":"ðŸ‡²ðŸ‡¹","en":"Malta","zh":"é©¬è€³ä»–"},"mu":{"flag":"ðŸ‡²ðŸ‡º","en":"Mauritius","zh":"æ¯›é‡Œæ±‚æ–¯"},"mv":{"flag":"ðŸ‡²ðŸ‡»","en":"Maldives","zh":"é©¬å°”ä»£å¤«"},"mw":{"flag":"ðŸ‡²ðŸ‡¼","en":"Malawi","zh":"é©¬æ‹‰ç»´"},"mx":{"flag":"ðŸ‡²ðŸ‡½","en":"Mexico","zh":"å¢¨è¥¿å“¥"},"my":{"flag":"ðŸ‡²ðŸ‡¾","en":"Malaysia","zh":"é©¬æ¥è¥¿äºš"},"mz":{"flag":"ðŸ‡²ðŸ‡¿","en":"Mozambique","zh":"èŽ«æ¡‘æ¯”å…‹"},"N. Cyprus":{"flag":"","en":"N. Cyprus","zh":"åŒ—å¡žæµ¦è·¯æ–¯"},"na":{"flag":"ðŸ‡³ðŸ‡¦","en":"Namibia","zh":"çº³ç±³æ¯”äºš"},"nc":{"flag":"ðŸ‡³ðŸ‡¨","en":"New Caledonia","zh":"æ–°å–€é‡Œå¤šå°¼äºš"},"ne":{"flag":"ðŸ‡³ðŸ‡ª","en":"Niger","zh":"å°¼æ—¥å°”"},"nf":{"flag":"ðŸ‡³ðŸ‡«","en":"Norfolk Island","zh":"è¯ºç¦å…‹å²›"},"ng":{"flag":"ðŸ‡³ðŸ‡¬","en":"Nigeria","zh":"å°¼æ—¥åˆ©äºš"},"ni":{"flag":"ðŸ‡³ðŸ‡®","en":"Nicaragua","zh":"å°¼åŠ æ‹‰ç“œ"},"nl":{"flag":"ðŸ‡³ðŸ‡±","en":"Netherlands","zh":"è·å…°"},"no":{"flag":"ðŸ‡³ðŸ‡´","en":"Norway","zh":"æŒªå¨"},"np":{"flag":"ðŸ‡³ðŸ‡µ","en":"Nepal","zh":"å°¼æ³Šå°”"},"nr":{"flag":"ðŸ‡³ðŸ‡·","en":"Nauru","zh":"ç‘™é²"},"nu":{"flag":"ðŸ‡³ðŸ‡º","en":"Niue","zh":"çº½åŸƒ"},"nz":{"flag":"ðŸ‡³ðŸ‡¿","en":"New Zealand","zh":"æ–°è¥¿å…°"},"om":{"flag":"ðŸ‡´ðŸ‡²","en":"Oman","zh":"é˜¿æ›¼"},"pa":{"flag":"ðŸ‡µðŸ‡¦","en":"Panama","zh":"å·´æ‹¿é©¬"},"pe":{"flag":"ðŸ‡µðŸ‡ª","en":"Peru","zh":"ç§˜é²"},"pf":{"flag":"ðŸ‡µðŸ‡«","en":"Fr. Polynesia","zh":"æ³•å±žæ³¢åˆ©å°¼è¥¿äºš"},"pg":{"flag":"ðŸ‡µðŸ‡¬","en":"Papua New Guinea","zh":"å·´å¸ƒäºšæ–°å‡ å†…äºš"},"ph":{"flag":"ðŸ‡µðŸ‡­","en":"Philippines","zh":"è²å¾‹å®¾"},"pk":{"flag":"ðŸ‡µðŸ‡°","en":"Pakistan","zh":"å·´åŸºæ–¯å¦"},"pl":{"flag":"ðŸ‡µðŸ‡±","en":"Poland","zh":"æ³¢å…°"},"pm":{"flag":"ðŸ‡µðŸ‡²","en":"St. Pierre and Miquelon","zh":"åœ£çš®åŸƒå°”å’Œå¯†å…‹éš†"},"pn":{"flag":"ðŸ‡µðŸ‡³","en":"Pitcairn Is.","zh":"çš®ç‰¹å‡¯æ©ç¾¤å²›"},"pr":{"flag":"ðŸ‡µðŸ‡·","en":"Puerto Rico","zh":"æ³¢å¤šé»Žå„"},"ps":{"flag":"ðŸ‡µðŸ‡¸","en":"Palestine","zh":"å·´å‹’æ–¯å¦"},"pt":{"flag":"ðŸ‡µðŸ‡¹","en":"Portugal","zh":"è‘¡è„ç‰™"},"pw":{"flag":"ðŸ‡µðŸ‡¼","en":"Palau","zh":"å¸•åŠ³"},"py":{"flag":"ðŸ‡µðŸ‡¾","en":"Paraguay","zh":"å·´æ‹‰åœ­"},"qa":{"flag":"ðŸ‡¶ðŸ‡¦","en":"Qatar","zh":"å¡å¡”å°”"},"re":{"flag":"ðŸ‡·ðŸ‡ª","en":"RÃ©union","zh":"ç•™å°¼æ±ª"},"ro":{"flag":"ðŸ‡·ðŸ‡´","en":"Romania","zh":"ç½—é©¬å°¼äºš"},"rs":{"flag":"ðŸ‡·ðŸ‡¸","en":"Serbia","zh":"å¡žå°”ç»´äºš"},"ru":{"flag":"ðŸ‡·ðŸ‡º","en":"Russia","zh":"ä¿„ç½—æ–¯"},"rw":{"flag":"ðŸ‡·ðŸ‡¼","en":"Rwanda","zh":"å¢æ—ºè¾¾"},"sa":{"flag":"ðŸ‡¸ðŸ‡¦","en":"Saudi Arabia","zh":"æ²™ç‰¹é˜¿æ‹‰ä¼¯"},"sb":{"flag":"ðŸ‡¸ðŸ‡§","en":"Solomon Is.","zh":"æ‰€ç½—é—¨ç¾¤å²›"},"sc":{"flag":"ðŸ‡¸ðŸ‡¨","en":"Seychelles","zh":"å¡žèˆŒå°”"},"sd":{"flag":"ðŸ‡¸ðŸ‡©","en":"Sudan","zh":"è‹ä¸¹"},"se":{"flag":"ðŸ‡¸ðŸ‡ª","en":"Sweden","zh":"ç‘žå…¸"},"sg":{"flag":"ðŸ‡¸ðŸ‡¬","en":"Singapore","zh":"æ–°åŠ å¡"},"sh":{"flag":"ðŸ‡¸ðŸ‡­","en":"Saint Helena","zh":"åœ£èµ«å‹’æ‹¿"},"si":{"flag":"ðŸ‡¸ðŸ‡®","en":"Slovenia","zh":"æ–¯æ´›æ–‡å°¼äºš"},"Siachen Glacier":{"flag":"","en":"Siachen Glacier","zh":"é”¡äºšç´å†°å·"},"sj":{"flag":"ðŸ‡¸ðŸ‡¯","en":"Svalbard and Jan Mayen","zh":"æ–¯ç“¦å°”å·´å’Œæ‰¬é©¬å»¶"},"sk":{"flag":"ðŸ‡¸ðŸ‡°","en":"Slovakia","zh":"æ–¯æ´›ä¼å…‹"},"sl":{"flag":"ðŸ‡¸ðŸ‡±","en":"Sierra Leone","zh":"å¡žæ‹‰åˆ©æ˜‚"},"sm":{"flag":"ðŸ‡¸ðŸ‡²","en":"San Marino","zh":"åœ£é©¬åŠ›è¯º"},"sn":{"flag":"ðŸ‡¸ðŸ‡³","en":"Senegal","zh":"å¡žå†…åŠ å°”"},"so":{"flag":"ðŸ‡¸ðŸ‡´","en":"Somalia","zh":"ç´¢é©¬é‡Œ"},"Somaliland":{"flag":"","en":"Somaliland","zh":"ç´¢é©¬é‡Œå…°"},"sr":{"flag":"ðŸ‡¸ðŸ‡·","en":"Suriname","zh":"è‹é‡Œå—"},"ss":{"flag":"ðŸ‡¸ðŸ‡¸","en":"S. Sudan","zh":"å—è‹ä¸¹"},"st":{"flag":"ðŸ‡¸ðŸ‡¹","en":"SÃ£o TomÃ© and Principe","zh":"åœ£å¤šç¾Žå’Œæ™®æž—è¥¿æ¯”"},"sv":{"flag":"ðŸ‡¸ðŸ‡»","en":"El Salvador","zh":"è¨å°”ç“¦å¤š"},"sx":{"flag":"ðŸ‡¸ðŸ‡½","en":"Sint Maarten","zh":"è·å±žåœ£é©¬ä¸"},"sy":{"flag":"ðŸ‡¸ðŸ‡¾","en":"Syria","zh":"å™åˆ©äºš"},"sz":{"flag":"ðŸ‡¸ðŸ‡¿","en":"Swaziland","zh":"æ–¯å¨å£«å…°"},"tc":{"flag":"ðŸ‡¹ðŸ‡¨","en":"Turks and Caicos Is.","zh":"ç‰¹å…‹æ–¯å’Œå‡¯ç§‘æ–¯ç¾¤å²›"},"td":{"flag":"ðŸ‡¹ðŸ‡©","en":"Chad","zh":"ä¹å¾—"},"tf":{"flag":"ðŸ‡¹ðŸ‡«","en":"Fr. S. Antarctic Lands","zh":"æ³•å±žå—éƒ¨å’Œå—æžé¢†åœ°"},"tg":{"flag":"ðŸ‡¹ðŸ‡¬","en":"Togo","zh":"å¤šå“¥"},"th":{"flag":"ðŸ‡¹ðŸ‡­","en":"Thailand","zh":"æ³°å›½"},"tj":{"flag":"ðŸ‡¹ðŸ‡¯","en":"Tajikistan","zh":"å¡”å‰å…‹æ–¯å¦"},"tk":{"flag":"ðŸ‡¹ðŸ‡°","en":"Tokelau","zh":"æ‰˜å…‹åŠ³"},"tl":{"flag":"ðŸ‡¹ðŸ‡±","en":"Timor-Leste","zh":"ä¸œå¸æ±¶"},"tm":{"flag":"ðŸ‡¹ðŸ‡²","en":"Turkmenistan","zh":"åœŸåº“æ›¼æ–¯å¦"},"tn":{"flag":"ðŸ‡¹ðŸ‡³","en":"Tunisia","zh":"çªå°¼æ–¯"},"to":{"flag":"ðŸ‡¹ðŸ‡´","en":"Tonga","zh":"æ±¤åŠ "},"tr":{"flag":"ðŸ‡¹ðŸ‡·","en":"Turkey","zh":"åœŸè€³å…¶"},"tt":{"flag":"ðŸ‡¹ðŸ‡¹","en":"Trinidad and Tobago","zh":"ç‰¹ç«‹å°¼è¾¾å’Œå¤šå·´å“¥"},"tv":{"flag":"ðŸ‡¹ðŸ‡»","en":"Tuvalu","zh":"å›¾ç“¦å¢"},"tw":{"flag":"ðŸ‡¹ðŸ‡¼","en":"Taiwan","zh":"å°æ¹¾"},"tz":{"flag":"ðŸ‡¹ðŸ‡¿","en":"Tanzania","zh":"å¦æ¡‘å°¼äºš"},"ua":{"flag":"ðŸ‡ºðŸ‡¦","en":"Ukraine","zh":"ä¹Œå…‹å…°"},"ug":{"flag":"ðŸ‡ºðŸ‡¬","en":"Uganda","zh":"ä¹Œå¹²è¾¾"},"um":{"flag":"ðŸ‡ºðŸ‡²","en":"U.S. Minor Outlying Is.","zh":"ç¾Žå›½æœ¬åœŸå¤–å°å²›å±¿"},"us":{"flag":"ðŸ‡ºðŸ‡¸","en":"United States","zh":"ç¾Žå›½"},"uy":{"flag":"ðŸ‡ºðŸ‡¾","en":"Uruguay","zh":"ä¹Œæ‹‰åœ­"},"uz":{"flag":"ðŸ‡ºðŸ‡¿","en":"Uzbekistan","zh":"ä¹Œå…¹åˆ«å…‹æ–¯å¦"},"va":{"flag":"ðŸ‡»ðŸ‡¦","en":"Vatican","zh":"æ¢µè’‚å†ˆ"},"vc":{"flag":"ðŸ‡»ðŸ‡¨","en":"St. Vin. and Gren.","zh":"åœ£æ–‡æ£®ç‰¹å’Œæ ¼æž—çº³ä¸æ–¯"},"ve":{"flag":"ðŸ‡»ðŸ‡ª","en":"Venezuela","zh":"å§”å†…ç‘žæ‹‰"},"vg":{"flag":"ðŸ‡»ðŸ‡¬","en":"British Virgin Is.","zh":"è‹±å±žç»´å°”äº¬ç¾¤å²›"},"vi":{"flag":"ðŸ‡»ðŸ‡®","en":"U.S. Virgin Is.","zh":"ç¾Žå±žç»´å°”äº¬ç¾¤å²›"},"vn":{"flag":"ðŸ‡»ðŸ‡³","en":"Vietnam","zh":"è¶Šå—"},"vu":{"flag":"ðŸ‡»ðŸ‡º","en":"Vanuatu","zh":"ç“¦åŠªé˜¿å›¾"},"wf":{"flag":"ðŸ‡¼ðŸ‡«","en":"Wallis and Futuna Is.","zh":"ç“¦åˆ©æ–¯å’Œå¯Œå›¾çº³"},"ws":{"flag":"ðŸ‡¼ðŸ‡¸","en":"Samoa","zh":"è¨æ‘©äºš"},"ye":{"flag":"ðŸ‡¾ðŸ‡ª","en":"Yemen","zh":"ä¹Ÿé—¨"},"yt":{"flag":"ðŸ‡¾ðŸ‡¹","en":"Mayotte","zh":"é©¬çº¦ç‰¹"},"za":{"flag":"ðŸ‡¿ðŸ‡¦","en":"South Africa","zh":"å—éž"},"zm":{"flag":"ðŸ‡¿ðŸ‡²","en":"Zambia","zh":"èµžæ¯”äºš"},"zw":{"flag":"ðŸ‡¿ðŸ‡¼","en":"Zimbabwe","zh":"æ´¥å·´å¸ƒéŸ¦"}},
            countryServer: [],
            countryNameMap: {},
            countryMapChartData: [],
            sensorList: [
                'TC0D', //CPU Die æ¸©åº¦ï¼Œä»£è¡¨ CPU å†…éƒ¨çš„æ¸©åº¦
                'TC0H', //CPU Heatsink æ¸©åº¦ï¼Œä»£è¡¨ CPU æ•£çƒ­å™¨çš„æ¸©åº¦
                'TC0P', //CPU Proximity æ¸©åº¦ï¼Œä»£è¡¨ CPU é™„è¿‘çš„æ¸©åº¦
                'k10temp', //AMD K10ï¼ˆPhenomã€Athlonã€Sempron ç­‰ï¼‰ç³»åˆ—å¤„ç†å™¨çš„æ¸©åº¦ç›‘æµ‹
                'coretemp_package_id_0', //æ•´ä¸ªå°è£…å¤„ç†å™¨æ¸©åº¦
                'cpu_thermal_zone', //å…¨å¿—
                'cpu-thermal', //æ ‘èŽ“æ´¾(åšé€š)
                'soc_thermal', //æ–°ç‘žèŠ¯å¾®
                'cpu_thermal', //è€ç‘žèŠ¯å¾®
                'ACPI\\ThermalZone\\TZ0__0', //Windows
                'ACPI\\ThermalZone\\CPUZ_0', //Windows
                'ACPI\\ThermalZone\\TZ00_0', //Windows
                'ACPI\\ThermalZone\\TZ001_0', //Windows
                'ACPI\\ThermalZone\\THM0_0' //Windows
            ]
        },
        mixins: [mixinsVue],
        created() {
            this.servers = JSON.parse('{{.Servers}}').servers;
            if(this.showGroup) {
                this.nodesTag = this.groupingData(this.handleNodes(this.servers),"Tag");
            } else {
                this.nodesNoTag = this.handleNodes(this.servers);
            }
            this.countryNameMap = this.initCountryNameMap();
            this.countryServer = this.initCountryServer();
            this.countryMapChartData = this.initCountryMapChartData();
        },
        mounted() {
            // åˆå§‹åŒ–æ—¶å»ºç«‹WebSocketè¿žæŽ¥
            this.connect();
            // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
            document.addEventListener("visibilitychange", () => {
                if (document.visibilityState === "visible") {
                    setTimeout(() => {
                        if (document.hasFocus()) {
                            this.connect();
                        }
                    }, 200);
                }
            });
        },
        methods: {
            initCountryNameMap(){
                const result = {};
                for (const item in this.countryMap) {
                    result[this.countryMap[item].en] = this.language=='zh-CN' ? this.countryMap[item].zh : this.countryMap[item].en;
                }
                return result;
            },
            initCountryServer() {
                let count = {};
                let result = [];
                let exist = {};
                this.servers.forEach(item => {
                    if (item.Host.CountryCode) {
                        if(item.Host.CountryCode.toLowerCase() == 'tw' || item.Host.CountryCode.toLowerCase() == 'hk' || item.Host.CountryCode.toLowerCase() == 'mo') item.Host.CountryCode = 'cn';
                        if (!exist[item.Host.CountryCode]) {
                            exist[item.Host.CountryCode] = true;
                            count[item.Host.CountryCode] = 1;
                            const obj = {
                                'countryCode': item.Host.CountryCode,
                                'count': count[item.Host.CountryCode]
                            };
                            result.push(obj);
                        } else {
                            count[item.Host.CountryCode]++;
                            result.find(obj => obj.countryCode === item.Host.CountryCode).count = count[item.Host.CountryCode];
                        }
                    }
                });
                return result;
            },
            initCountryMapChartData(){
                let result = [];
                this.countryServer.forEach(item => {
                    var obj = {
                        "name": this.language=='zh-CN' ? this.countryMap[item.countryCode].zh : this.countryMap[item.countryCode].en,
                        "value": item.count
                    }
                    result.push(obj);
                });
                return result;
            },
            showMapChart(){
                // å¤„ç†å¼‚å¸¸
                if( this.countryMapChartData.length == 0 ) {
                    console.log('init countryMapChartData not complete');
                    return;
                }
                const unit = this.language=='zh-CN' ? 'å°' : 'servers';
                const isMobile = this.checkIsMobile();
                const width = isMobile ? 338 : 1102;
                const height = isMobile ? 200 : 500;
                const backgroundColor = this.theme == "dark" ? '#1C1D26' : '#ffffff';
                const inRangeColor = this.theme == "dark" ? '#D2B206' : '#FFDF32';
                const tooltipBackgroundColor = this.theme == "dark" ? "#ffffff" : '#ffffff';
                const tooltipBorderColor = this.theme == "dark" ? "#ffffff" : "#ffffff"; 
                const fontSize = isMobile ? 10 : 12;
                const fontColor = this.theme == "dark" ? "#000000" : "#000000";     
                const chartContainer = document.getElementById('mapChart');
                const mapChart = echarts.init(chartContainer, '', { // initå›¾è¡¨
                    renderer: 'canvas',
                    useDirtyRect: false,
                    width: width,
                    height: height,
                });
                const option = {
                    title: {
                        show: false,
                    },
                    backgroundColor: backgroundColor,
                    grid: {
                        top: 0,
                        left: 10,
                        right: 10
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: function (params) {
                            if (params.data && params.data.value > 0) {
                                return params.name + ' ' + params.data.value + ' ' + unit;
                            } else {
                                return '';
                            }
                        },
                        backgroundColor: tooltipBackgroundColor,
                        borderColor: tooltipBorderColor,
                        padding: [4,10],
                        textStyle: {
                            fontSize: fontSize,
                            color: fontColor
                        }
                    },
                    visualMap: {
                        show: false,
                        min: 0,
                        max: 1000,
                        calculable: false,
                        inRange: {
                            color: inRangeColor
                        }
                    },
                    series: [
                        {
                            type: 'map',
                            mapType: 'world',
                            roam: true,
                            label: {
                                show: false,
                                fontSize: 8
                            },
                            data: this.countryMapChartData,
                            nameMap: this.countryNameMap,
                        }
                    ]
                };
                mapChart.setOption(option);
            },
            isWindowsPlatform(str) {
                return str.includes('Windows')
            },
            getPlatformName(str){
                if (str.toLowerCase().includes('opensuse')) {
                    return 'openSUSE';
                }
                return str;
            },
            getFontLogoClass(str) {
                if (["almalinux",
                        "alpine",
                        "aosc",
                        "apple",
                        "archlinux",
                        "archlabs",
                        "artix",
                        "budgie",
                        "centos",
                        "coreos",
                        "debian",
                        "deepin",
                        "devuan",
                        "docker",
                        "elementary",
                        "fedora",
                        "ferris",
                        "flathub",
                        "freebsd",
                        "gentoo",
                        "gnu-guix",
                        "illumos",
                        "kali-linux",
                        "linuxmint",
                        "mageia",
                        "mandriva",
                        "manjaro",
                        "nixos",
                        "openbsd",
                        "opensuse",
                        "pop-os",
                        "raspberry-pi",
                        "redhat",
                        "rocky-linux",
                        "sabayon",
                        "slackware",
                        "snappy",
                        "solus",
                        "tux",
                        "ubuntu",
                        "void",
                        "zorin"].indexOf(str)
                    > -1) {
                    return str;
                }
                if (str == 'darwin') {
                    return 'apple';
                }
                if (['openwrt', 'linux', "immortalwrt"].indexOf(str) > -1) {
                    return 'tux';
                }
                if (str == 'amazon') {
                    return 'redhat';
                }
                if (str == 'arch') {
                    return 'archlinux';
                }
                if (str.toLowerCase().includes('opensuse')) {
                    return 'opensuse';
                }
                return '';
            },
            secondToDate(s) {
                const d = Math.floor(s / 3600 / 24);
                if (d > 0) {
                    return d + ' {{tr "Day"}}'
                }
                const h = Math.floor(s / 3600 % 24);
                const m = Math.floor(s / 60 % 60);
                const second = Math.floor(s % 60);
                return h + ":" + ("0" + m).slice(-2) + ":" + ("0" + second).slice(-2);
            },
            formatTimestamp(t) {
                return new Date(t * 1000).toLocaleString()
            },
            formatByteSize(bs) {
                const x = this.readableBytes(bs)
                return x !== "NaN undefined" ? x : '0B'
            },
            formatPercent(live, used, total) {
                //const percent = live ? (this.toFixed2(used / total * 100) || 0) : 0
                const percent = (this.toFixed2(used / total * 100) || 0)
                return this.formatPercents(live,percent)
            },
            formatPercents(live,percent) {
                //if(!live) { percent = 0; }
                if (isNaN(percent)) {
                    percent = 0;
                }
                if (percent <= 0) {
                    percent = 0;
                }
                if (percent >= 100) {
                    percent = 100;
                }
                if (!this.cache[percent]) {
                    this.cache[percent] = {
                        class: 'progress-bar progress-bar-success',
                        style: `width: ${parseInt(percent)+1}%`,
                        percent,
                    }
                    if (percent < 80) {
                        this.cache[percent].class = 'progress-bar progress-bar-success'
                    } else if (percent < 90) {
                        this.cache[percent].class = 'progress-bar progress-bar-warning'
                    } else {
                        this.cache[percent].class = 'progress-bar progress-bar-danger'
                    }
                }
                return this.cache[percent]
            },
            readableBytes(bytes) {
                if (!bytes) {
                    return '0B'
                }
                const i = Math.floor(Math.log(bytes) / Math.log(1024)),
                    sizes = ["B", "K", "M", "G", "T", "P", "E", "Z", "Y"];
                return parseFloat((bytes / Math.pow(1024, i)).toFixed(2)) + sizes[i];
            },
            connect() {
                // å¦‚æžœå·²ç»å­˜åœ¨ WebSocket è¿žæŽ¥å¹¶ä¸”å¤„äºŽå¼€å¯çŠ¶æ€ï¼Œåˆ™ä¸é‡å¤å»ºç«‹è¿žæŽ¥
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    console.log('Closing old WebSocket connection...');
                    this.ws.close();
                }
                const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
                this.ws = new WebSocket(wsProtocol + '://' + window.location.host + '/ws');

                this.ws.onopen = function () {
                    console.log("Connection open ...")
                }
                this.ws.onmessage = (evt) => {
                    let jsonData = evt.data
                    const data = JSON.parse(jsonData)
                    for (let i = 0; i < data.servers?.length; i++) {
                        const ns = data.servers[i];
                        if (!ns.Host) {
                            data.servers[i].live = false
                        } else {
                            const lastActive = new Date(ns.LastActive).getTime()
                            data.servers[i].live = data.now - lastActive <= 10 * 1000;
                        }
                    }
                    if(this.showGroup) {
                        this.nodesTag = this.groupingData(this.handleNodes(data.servers),"Tag");
                    } else {
                        this.nodesNoTag = this.handleNodes(data.servers);
                    }
                }
                this.ws.onclose = () => {
                    setTimeout(() => {
                        this.connect();
                    }, 5000);
                };
                this.ws.onerror = () => {
                    this.ws.close()
                }
            },
            handleNodes(servers) {
                let nodes = []
                servers?.forEach(server => {
                    let platform = server.Host.Platform;
                    if (this.isWindowsPlatform(platform)) {
                        platform = "windows"
                    }else if (platform === "immortalwrt") {
                        platform = "openwrt"
                    }
                    let node = {
                        ID: server.ID,
                        name: server.Name,
                        os: platform,
                        location: server.Host.CountryCode,
                        stateuptime: server.State.Uptime,
                        uptime: this.secondToDate(server.State.Uptime),
                        load: this.toFixed2(server.State.Load1),
                        network: this.getNetworkSpeed(server.State.NetInSpeed, server.State.NetOutSpeed),
                        traffic: this.formatByteSize(server.State.NetInTransfer) + ' | ' + this.formatByteSize(server.State.NetOutTransfer),
                        cpu: this.formatPercents(server.live, this.toFixed2(server.State.CPU)),
                        memory: this.formatPercent(server.live, server.State.MemUsed, server.Host.MemTotal),
                        hdd: this.formatPercent(server.live, server.State.DiskUsed, server.Host.DiskTotal),
                        online: server.live,
                        state: server.State,
                        host: server.Host,
                        lastActive: server.LastActive,
                        Tag: server.Tag,
                    }
                    nodes.push(node)
                })
                return nodes;
            },
            getNetworkSpeed(netInSpeed, netOutSpeed) {
                return this.formatByteSize(netInSpeed) + ' | ' + this.formatByteSize(netOutSpeed)
            },
            toggleDetailedTemp(id){
                const tempDom = document.getElementById(`temp-${id}`); 
                const tempDetailShow = tempDom.getAttribute('temp-detail-show');
                const tempMain = document.getElementById(`temp-main-${id}`); 
                const tempDetail = document.getElementById(`temp-detail-${id}`); 
                if (tempDetailShow == 0){
                    tempMain.style.display = 'none';
                    tempDetail.style.display = 'inline';
                    tempDom.setAttribute('temp-detail-show', 1);
                } else {
                    tempMain.style.display = 'inline';
                    tempDetail.style.display = 'none';
                    tempDom.setAttribute('temp-detail-show', 0);
                }
            },
            getTemperature(temperatureList, sensorList) {
                // å°† sensorList ä¸­çš„æ‰€æœ‰é¡¹è½¬æ¢ä¸ºå°å†™
                const lowerCaseSensorList = sensorList.map(sensor => sensor.toLowerCase());

                // åˆå¹¶è¿‡æ»¤é€»è¾‘ï¼šè¿‡æ»¤å‡º Temperature ä¸ä¸º 0 ä¸” Name åœ¨ sensorList ä¸­çš„å…ƒç´ ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
                const filtered = temperatureList.filter(item => item.Temperature !== 0 && lowerCaseSensorList.includes(item.Name.toLowerCase()));

                // å¦‚æžœæœ‰åŒ¹é…çš„å…ƒç´ ï¼Œåˆ™è®¡ç®—è¿™äº›å…ƒç´ çš„ Temperature çš„æœ€å¤§å€¼
                if (filtered.length > 0) {
                    return filtered.reduce((max, current) => {
                        return current.Temperature > max ? current.Temperature : max;
                    }, filtered[0].Temperature);
                }

                // å¦‚æžœæ²¡æœ‰åŒ¹é…çš„å…ƒç´ ï¼Œåˆ™è®¡ç®— temperatureList ä¸­æ‰€æœ‰ Temperature ä¸ä¸º 0 çš„å…ƒç´ çš„æœ€å¤§å€¼
                const nonZeroTemps = temperatureList.filter(item => item.Temperature !== 0);
                if (nonZeroTemps.length > 0) {
                    return nonZeroTemps.reduce((max, current) => {
                        return current.Temperature > max ? current.Temperature : max;
                    }, nonZeroTemps[0].Temperature);
                }

                // å¦‚æžœæ‰€æœ‰å…ƒç´ çš„ Temperature éƒ½ä¸º 0ï¼Œåˆ™è¿”å›žä¸€ä¸ªé»˜è®¤å€¼ 0
                return 0;
            },
            showCharts(event, id) {
                const chartContainer = this.$refs[`chart${id}`][0];
                const chartboxShow = chartContainer.getAttribute('chartbox-show');
                chartContainer.setAttribute('chartbox-show', chartboxShow === '0' ? '1' : '0');
                const isAriaExpandedFalse = event.currentTarget.getAttribute('aria-expanded') === 'false';
                if (!isAriaExpandedFalse) return;
                // å‘èµ·æ•°æ®è¯·æ±‚
                const url = `/api/v1/monitor/${id}`;
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.result) { // æ•°æ®è¯·æ±‚æˆåŠŸï¼Œæ›´æ–°æ•°æ®å¹¶æ¸²æŸ“å›¾è¡¨
                            this.chartDataList[id - 1] = data.result;
                            this.$nextTick(() => {
                                this.renderCharts(id);
                            });
                        } else {
                            console.log('this agent (id:'+ id + ') has no monitor.');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            },
            renderCharts(id, reload = false) {
                if (!this.chartDataList[id - 1]) return;
                const chartData = this.chartDataList[id - 1];
                const chartContainer = this.$refs[`chart${id}`][0];
                if (reload) { //ç‚¹å‡»åˆ‡æ¢äº®è‰²/æš—è‰²é£Žæ ¼æ¨¡å¼æ—¶,é‡æ–°è½½å…¥echartså›¾è¡¨çš„é€»è¾‘,
                    // ç¬¬ä¸€æ­¥,æŸ¥æ‰¾å·²ç»æ¸²æŸ“å‡ºçš„å›¾è¡¨å®¹å™¨,å¹¶é”€æ¯å®ƒ
                    const existingChart = echarts.getInstanceByDom(chartContainer);
                    if (existingChart) existingChart.dispose();
                    // ç¬¬äºŒæ­¥,å¦‚æžœå›¾è¡¨å®¹å™¨å¤„äºŽä¸å¯è§çŠ¶æ€chartboxShow=0,ä¸é‡æ–°æ¸²æŸ“å‡ºæ–°çš„å›¾è¡¨,
                    // å¦‚æžœå›¾è¡¨å®¹å™¨å¤„äºŽå¯è§çŠ¶æ€chartboxShow=1,é‡æ–°æ¸²æŸ“å‡ºæ–°çš„å›¾è¡¨
                    const chartboxShow = chartContainer.getAttribute('chartbox-show');
                    if ( chartboxShow === '0' ) return; 
                }
                // å®šä¹‰å›¾è¡¨å‚æ•°å€¼
                const MaxTCPPingValue = {{.Conf.MaxTCPPingValue}} ? {{.Conf.MaxTCPPingValue}} : 300;
                const isMobile = this.checkIsMobile();
                const fontSize = isMobile ? 10 : 14;
                const gridLeft = isMobile ? 25 : 36;
                const gridRight = isMobile ? 5 : 20;
                const legendLeft = isMobile ? 'center' : 'center';
                const legendTop = isMobile ? 5 : 5;
                const legendPadding= isMobile ? [5,0,5,0] : [5,0,5,0];
                const systemDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                const theme = localStorage.getItem("theme") ? localStorage.getItem("theme") : systemDarkMode;
                const chartTheme = theme == "dark" ? "dark" : "default";
                const fontColor = theme == "dark" ? "#f1f1f1" : "#000000";
                const backgroundColor = theme == "dark" ? "#1C1D26" : '';
                const tooltipBackgroundColor = theme == "dark" ? "#1C1D26" : '#ffffff';
                const tooltipBorderColor = theme == "dark" ? "#31363B" : "#ffffff";
                // æ¸²æŸ“å›¾è¡¨
                const chart = echarts.init(chartContainer, chartTheme, {
                    renderer: 'canvas',
                    useDirtyRect: false,
                    width: 'auto',
                    height: 300,
                });
                const xAxisData = chartData[0].created_at.map(time => new Date(time).toLocaleString());
                const seriesData = chartData.map(item => {
                    let loss = 0;
                    const data = item.avg_delay.map((avgDelay, index) => {                        
                        if(avgDelay > 0 && avgDelay < MaxTCPPingValue){
                            loss += avgDelay > 0.9 * MaxTCPPingValue ? 1 : 0;
                            return [item.created_at[index], avgDelay];
                        }else{
                            loss += 1;
                        }
                    });
                    const lossRate = ((loss / item.created_at.length) * 100).toFixed(1);
                    item.monitor_name = item.monitor_name.includes("%") ? item.monitor_name : `${item.monitor_name} ${lossRate}%`;
                    return {
                        name: item.monitor_name,
                        type: 'line',
                        smooth: true,
                        symbol: 'none',
                        data: data,
                        connectNulls: true
                    };
                });

                const legendData = chartData.map(item => item.monitor_name);
                const maxLegendsPerRowMobile = localStorage.getItem("maxLegendsPerRowMobile") ? localStorage.getItem("maxLegendsPerRowMobile") : 3;
                const maxLegendsPerRowPc = localStorage.getItem("maxLegendsPerRowPc") ? localStorage.getItem("maxLegendsPerRowPc") : 6;
                const autoIncrement = Math.floor((legendData.length - 1) / (isMobile ? maxLegendsPerRowMobile : maxLegendsPerRowPc)) * (isMobile ? 20 : 28)
                const height = 300 + autoIncrement;
                const gridTop = 40 + autoIncrement;
                const legendIcon = isMobile ? 'rect' : ""; 
                const itemWidth = isMobile ? 10 : 25;
                const itemHeight = isMobile ? 10 : 14;
                chart.resize({
                    width: 'auto',
                    height: height
                });

                const option = {
                    backgroundColor: backgroundColor,
                    title: {
                        show: false
                    },
                    tooltip: {
                        trigger: 'axis',
                        backgroundColor: tooltipBackgroundColor,
                        borderColor: tooltipBorderColor,
                        textStyle: {
                            fontSize: fontSize,
                            color: fontColor
                        }
                    },
                    legend: {
                        data: legendData,
                        show: true,
                        icon: legendIcon,
                        textStyle: {
                            fontSize: fontSize,
                            color: fontColor
                        },
                        top: legendTop,
                        bottom: 0,
                        left: legendLeft,
                        padding: legendPadding,
                        itemWidth: itemWidth,
                        itemHeight: itemHeight,
                    },
                    xAxis: {
                        type: 'time',
                        data: xAxisData,
                        axisLabel: {
                            textStyle: {
                                fontSize: fontSize
                            }
                        }
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            textStyle: {
                                fontSize: fontSize
                            }
                        }
                    },
                    dataZoom: [
                        {
                            type: 'slider',
                            start: 0,
                            end: 100
                        }
                    ],
                    series: seriesData,
                    textStyle: {
                        fontSize: fontSize,
                        color: fontColor
                    },
                    grid: {
                        top: gridTop,
                        left: gridLeft,
                        right: gridRight
                    }
                };
                chart.setOption(option);
            },
            reloadCharts() { // é‡æ–°åŠ è½½æ‰€æœ‰å›¾è¡¨
                this.servers.forEach(node => {
                    const id = node.ID;
                    const chartData = this.chartDataList[id - 1];
                    if (chartData) {
                        this.renderCharts(id,true);
                    }
                });
            }
        }
    })
</script>
{{template "theme-server-status/footer" .}}
{{end}}
